 PARAMETER tcWhere
  

TEXT TO lcWhere TEXTMERGE noshow
	(EMPTY(<<fltrAruanne.asutusid>>) or rekv_id = <<fltrAruanne.asutusid>>)
	and konto like '<<ALLTRIM(fltrAruanne.kood4)>>%'
	and coalesce(tegev,'') like '<<ALLTRIM(fltrAruanne.kood1)>>%'
	and coalesce(allikas,'') like '<<ALLTRIM(fltrAruanne.kood2)>>%'
	and (deebet <> 0 or kreedit <> 0)
ENDTEXT

l_params  = ''
TEXT TO l_params TEXTMERGE noshow
	<<IIF(!EMPTY(fltrAruanne.konto),'Konto=','')>> <<ALLTRIM(fltrAruanne.konto)>> <<IIF(!EMPTY(fltrAruanne.konto),'%','')>> 
ENDTEXT

TEXT TO l_params TEXTMERGE NOSHOW additive
	<<IIF(!EMPTY(fltrAruanne.tunnus),IIF(LEN(l_params)> 0 ,', ','') + 'Tunnus=','')>> <<ALLTRIM(fltrAruanne.tunnus)>> <<IIF(!EMPTY(fltrAruanne.tunnus),'%','')>> 
ENDTEXT
TEXT TO l_params TEXTMERGE NOSHOW additive	
	<<IIF(!EMPTY(fltrAruanne.proj),IIF(LEN(l_params)> 0 ,', ','') + 'Projekt=','')>> <<ALLTRIM(fltrAruanne.proj)>> <<IIF(!EMPTY(fltrAruanne.proj),'%','')>> 
ENDTEXT
TEXT TO l_params TEXTMERGE NOSHOW additive		
	<<IIF(!EMPTY(fltrAruanne.uritus),IIF(LEN(l_params)> 0 ,', ','') + 'Üritus=','')>> <<ALLTRIM(fltrAruanne.uritus)>> <<IIF(!EMPTY(fltrAruanne.uritus),'%','')>> 
ENDTEXT
TEXT TO l_params TEXTMERGE NOSHOW additive		
	<<IIF(!EMPTY(fltrAruanne.kood1),IIF(LEN(l_params)> 0 ,', ','') + 'Tegevus=','')>> <<ALLTRIM(fltrAruanne.kood1)>> <<IIF(!EMPTY(fltrAruanne.kood1),'%','')>> 
ENDTEXT

IF !USED('fltrParametid')
	CREATE CURSOR fltrParametid (params m)
	APPEND BLANK
ENDIF

replace fltrParametid.params WITH l_params IN fltrParametid

SET STEP ON 

TEXT TO l_params TEXTMERGE noshow
	{
		"id":"1",
		"tunnus":"<<ALLTRIM(fltrAruanne.tunnus)>>",
		"konto":"<<ALLTRIM(fltrAruanne.konto)>>",
		"proj":"<<ALLTRIM(fltrAruanne.proj)>>",
		"uritus":"<<ALLTRIM(fltrAruanne.uritus)>>",
		"tegevus":"<<ALLTRIM(fltrAruanne.kood1)>>"
	}
ENDTEXT

l_kpv1 = fltrAruanne.kpv1
l_kpv2 = fltrAruanne.kpv2
l_kond = IIF(EMPTY(fltrAruanne.kond), null, 1)

lError = oDb.readFromModel('aruanned\eelarve\saldoandmik', 'saldoandmik_report', 'l_kpv2, gRekv, l_kond, l_params', 'tmpReport', lcWhere)
If !lError
	Messagebox('Viga',0+16, 'Eelarve kulud')
	Set Step On
	Select 0
	Return .F.
ENDIF

SELECT tmpReport

Select konto, tp, tegev, allikas, rahavoog, ;
	sum(deebet) as deebet, sum(kreedit) as kreedit;
	from tmpReport ;
	WHERE (deebet <> 0 OR kreedit <> 0 );
	GROUP By konto, tp, tegev, allikas, rahavoog ;
	ORDER By konto, tp, tegev, allikas, rahavoog ;
	INTO Cursor saldoaruanne_report1

Use In tmpReport
Select saldoaruanne_report1