Parameter cWhere

TEXT TO lcWhere TEXTMERGE noshow
	(EMPTY(<<fltrAruanne.asutusid>>) or rekv_id = <<fltrAruanne.asutusid>>)
	and tunnus ilike '<<ALLTRIM(fltrAruanne.tunnus)>>%'
	and artikkel like '<<ALLTRIM(fltrAruanne.kood5)>>%'
	and tegev like '<<ALLTRIM(fltrAruanne.kood1)>>%'
	and allikas like '<<ALLTRIM(fltrAruanne.kood2)>>%'
ENDTEXT

If Empty(fltrAruanne.kond)
	TEXT TO lcWhere ADDITIVE TEXTMERGE noshow
			and rekv_id = <<gRekv>>
	ENDTEXT
ENDIF
l_aasta = year(fltrAruanne.kpv1)
l_kpv = fltrAruanne.kpv2
l_kond = EMPTY(fltrAruanne.tunn)


lError = oDb.readFromModel('aruanned\eelarve\tulud_allikad', 'tulud_report', 'l_aasta,l_kpv,l_kond, gRekv', 'tmpReport', lcWhere)
If !lError
	Messagebox('Viga',0+16, 'Eelarve tulud')
	Set Step On
	Select 0
	Return .F.
Endif

Select artikkel, l.nimetus, Sum(eelarve) As eelarve, Sum(Iif(Empty(fltrAruanne.kassakulud), tegelik, kassa)) As taitmine,;
	rekv.regkood, rekv.nimetus As asutus ,;
	parent.nimetus As parasutus,Parent.regkood As parregkood ;
	from tmpReport ;
	LEFT Outer Join comEelarveRemote l On l.kood = tmpReport.artikkel ;
	INNER Join comRekvRemote rekv On tmpReport.rekv_id = rekv.Id ;
	LEFT Outer Join comRekvRemote Parent On rekv.parentid = Parent.Id ;
	GROUP By artikkel, l.nimetus, rekv.regkood, rekv.nimetus,;
	parent.nimetus,Parent.regkood ;
	ORDER By Parent.nimetus, rekv.nimetus, artikkel;
	INTO Cursor eelarve_report2

Use In tmpReport
Select eelarve_report2

