**
** login.fxp
**
*
Define Class login As dokument
	Name = "login"
	asUtusid = 0
	Userid = 0
	Width = 440
	Caption = 'Login'
	Height = 100
	AutoCenter = .T.
	ShowWindow = 2
	WindowType = 1
	AlwaysOnTop = .T.
	Key = ''
	Message = ''
	connection = 'test_server'
*!*	 ADD OBJECT coMrekv AS myCombo WITH toP = 5, leFt = 100, wiDth = 400,  ;
*!*	     naMe = "comrekv", boUndcolumn = 1, boUndto = .T., roWsourcetype = 6,  ;
*!*	     roWsource = "comkey.omanik, id", coLumncount = 2, coLumnwidths =  ;
*!*	     "400,0", coLumnlines = 0, vaLue = 0, style = 2
	Add Object txTkasutaja As myTxt With Top = 5, Left = 100, Width = 200,  ;
		naMe = "txtKasutaja"
	Add Object txTparool As myTxt With Top = 35, Left = 100, Width = 200,  ;
		naMe = "txtParool", PasswordChar = '*'
	Add Object btNok As myBtn With Caption = '', Top = 5, Left = 325, Width =  ;
		100, Name = "btnOk", Picture = "pictures\btok.bmp"
	Add Object btNcancel As myBtn With Caption = '', Top = 40, Left = 325,  ;
		wiDth = 100, Name = "btnCancel", Picture = "pictures\btExit.bmp"
*!*	 ADD OBJECT lbLasutus AS myLbl WITH toP = 5, leFt = 5, naMe = "lblAsutus",  ;
*!*	     caPtion = "Database:"
	Add Object lbLkasutaja As myLbl With Top = 5, Left = 5, Name =  ;
		"lblKasutaja", Caption = "Kasutaja nimi:"
	Add Object lbLparool As myLbl With Top = 35, Left = 5, Name =  ;
		"lblParool", Caption = "Parool:"
*
	Procedure btNok.Click

		Set Classlib To Logo
		olOgo = Createobject('logo')
		olOgo.Show()
		With Thisform
			.Visible = .F.
			ocOnnect = Newobject('connect', 'connect')
			leRror = ocOnnect.odB(thisform.connection, ALLTRIM(.txTkasutaja.Value), ;
				RTRIM(Ltrim(.txTparool.Value)),Thisform.Key,.T.)

			If leRror=.T.
				On Key Label CTRL+A Do ONKEY With ('CTRL+A')
				On Key Label CTRL+S Do ONKEY With ('CTRL+S')
				On Key Label CTRL+P Do ONKEY With ('CTRL+P')
				_Screen.Visible = .T.
			ELSE
				MESSAGEBOX('Vale parool või kasutaja nimi',0+16,'Login')
				Clear Events
			Endif
			Release olOgo
		Endwith
		Release Thisform
	Endproc
*
	Procedure btNcancel.Click
		Clear Events
		Release Thisform
	Endproc
*
*!*	     PROCEDURE coMrekv.init
*!*	      thIs.vaLue = coMkey.id
*!*	     ENDPROC
*
	Procedure Init
		On Error Do ERR With Program(), Lineno(1)

* read and open config
	DO read_config
	IF USED('v_config') AND RECCOUNT('v_config') > 0
		this.connection = ALLTRIM(v_config.name)
	ENDIF
	
	Endproc
*
	Procedure Unload
		With This
			If Empty(grEkv)
				Clear Events
			Endif
		Endwith
	Endproc
*
	Function encryptpass
		Lparameter tcPass
		lcCryptpath = Encrypt(f_Key(),tcPass)
		Replace v_Pass.paRool With lcCryptpath In v_Pass
		odB.cuRsorupdate('v_pass')
		Return lcCryptpath
	Endfunc
*
	Function decryptpass
		Lparameter tcPass
		lcDecryptpath = deCrypt(f_Key(),tcPass)
		Return lcDecryptpath
	Endfunc
*
	Procedure AvadaAruanned
	Endproc
*
	Procedure viGa
		Local lcString
		This.Message = "Login ebaonestus"
		lcString = "messagebox('"+This.Message+"','Viga')"
		&lcString
		Release Thisform
	Endproc
*
Enddefine
*
